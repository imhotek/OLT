'use strict';

function Penmen(str,canvas,top_x1,top_y1,top_x2,top_y2,bot_x3,bot_y3,bot_x4,bot_y4,time){
    var snd_obj = {
        text:str,
        x1:top_x1,
        y1:top_y1,
        x2:top_x2,
        y2:top_y2,
        x3:bot_x3,
        y3:bot_y3,
        x4:bot_x4,
        y4:bot_y4,
        duration:time
    };
    function _createXMLHttp(){
        if(window.XMLHttpRequest){
            return new XMLHttpRequest();
        }else{
            return new ActiveXObject('Microsoft.XMLHTTP');
        }
    }
    var ctx = canvas[0].getContext('2d');
    function _draw(obj){console.log(obj);
        ctx.strokeStyle = "white";
        ctx.beginPath();
        var i,j;
        j = i = 0;
        var handle = setInterval(function(){
            if(i < obj['paths'].length){
                if(j < obj['paths'][i].length-1 && !obj['paths'][i][j]['pen_up']){
                    ctx.moveTo(obj['paths'][i][j]['x'],obj['paths'][i][j]['y']);
                    ctx.lineTo(obj['paths'][i][j+1]['x'],obj['paths'][i][j+1]['y']);
                    ctx.stroke();
                    j++;
                }else if(j >= obj['paths'][i].length-1 && !obj['paths'][i][j]['pen_up']){
                    i++;j=0;
                }else if(obj['paths'][i][j]['pen_up']){
                    j++;
                }
            }else{
                ctx.closePath();
                clearInterval(handle);
                handle = null; 
                console.log('done');
            }
        },0.5);
    }
    function init(){
        var obj= Object.create({"ref_rate":"0","paths":[[{"x":"341.500000","y":"0.000000"},{"x":"337.402008","y":"1.608000"},{"x":"333.304016","y":"3.216000"},{"x":"329.206024","y":"4.824000"},{"x":"325.108032","y":"6.432000"},{"x":"321.010040","y":"8.040000"},{"x":"316.912048","y":"9.648000"},{"x":"312.814056","y":"11.256000"},{"x":"308.716064","y":"12.863999"},{"x":"304.618073","y":"14.471999"},{"x":"300.520081","y":"16.080000"},{"x":"296.422089","y":"17.688000"},{"x":"292.324097","y":"19.296000"},{"x":"288.226105","y":"20.903999"},{"x":"284.128113","y":"22.511999"},{"x":"280.030121","y":"24.119999"},{"x":"275.932129","y":"25.727999"},{"x":"271.834137","y":"27.335999"},{"x":"267.736145","y":"28.943998"},{"x":"263.638153","y":"30.551998"},{"x":"259.540161","y":"32.160000"},{"x":"255.442154","y":"33.768002"},{"x":"251.344147","y":"35.376003"},{"x":"247.246140","y":"36.984005"},{"x":"243.148132","y":"38.592007"},{"x":"239.050125","y":"40.200008"},{"x":"234.952118","y":"41.808010"},{"x":"230.854111","y":"43.416012"},{"x":"226.756104","y":"45.024014"},{"x":"222.658096","y":"46.632015"},{"x":"218.560089","y":"48.240017"},{"x":"214.462082","y":"49.848019"},{"x":"210.364075","y":"51.456020"},{"x":"206.266068","y":"53.064022"},{"x":"202.168060","y":"54.672024"},{"x":"198.070053","y":"56.280025"},{"x":"193.972046","y":"57.888027"},{"x":"189.874039","y":"59.496029"},{"x":"185.776031","y":"61.104031"},{"x":"181.678024","y":"62.712032"},{"x":"177.580017","y":"64.320030"},{"x":"173.482010","y":"65.928032"},{"x":"169.384003","y":"67.536034"},{"x":"165.285995","y":"69.144035"},{"x":"161.187988","y":"70.752037"},{"x":"157.089981","y":"72.360039"},{"x":"152.991974","y":"73.968040"},{"x":"148.893967","y":"75.576042"},{"x":"144.795959","y":"77.184044"},{"x":"140.697952","y":"78.792046"},{"x":"136.599945","y":"80.400047"},{"x":"132.501938","y":"82.008049"},{"x":"128.403931","y":"83.616051"},{"x":"124.305931","y":"85.224052"},{"x":"120.207932","y":"86.832054"},{"x":"116.109932","y":"88.440056"},{"x":"112.011932","y":"90.048058"},{"x":"107.913933","y":"91.656059"},{"x":"103.815933","y":"93.264061"},{"x":"99.717934","y":"94.872063"},{"x":"95.619934","y":"96.480064"},{"x":"91.521935","y":"98.088066"},{"x":"87.423935","y":"99.696068"},{"x":"83.325935","y":"101.304070"},{"x":"79.227936","y":"102.912071"},{"x":"75.129936","y":"104.520073"},{"x":"71.031937","y":"106.128075"},{"x":"66.933937","y":"107.736076"},{"x":"62.835938","y":"109.344078"},{"x":"58.737938","y":"110.952080"},{"x":"54.639938","y":"112.560081"},{"x":"50.541939","y":"114.168083"},{"x":"46.443939","y":"115.776085"},{"x":"42.345940","y":"117.384087"},{"x":"38.247940","y":"118.992088"},{"x":"34.149940","y":"120.600090"},{"x":"30.051941","y":"122.208092"},{"x":"25.953941","y":"123.816093"},{"x":"21.855942","y":"125.424095"},{"x":"17.757942","y":"127.032097"},{"x":"13.659943","y":"128.640091"},{"x":"9.561943","y":"130.248093"},{"x":"5.463943","y":"131.856094"},{"x":"1.365943","y":"133.464096"},{"pen_up":"true"},{"x":"341.500000","y":"0.000000"},{"x":"345.597992","y":"1.608000"},{"x":"349.695984","y":"3.216000"},{"x":"353.793976","y":"4.824000"},{"x":"357.891968","y":"6.432000"},{"x":"361.989960","y":"8.040000"},{"x":"366.087952","y":"9.648000"},{"x":"370.185944","y":"11.256000"},{"x":"374.283936","y":"12.863999"},{"x":"378.381927","y":"14.471999"},{"x":"382.479919","y":"16.080000"},{"x":"386.577911","y":"17.688000"},{"x":"390.675903","y":"19.296000"},{"x":"394.773895","y":"20.903999"},{"x":"398.871887","y":"22.511999"},{"x":"402.969879","y":"24.119999"},{"x":"407.067871","y":"25.727999"},{"x":"411.165863","y":"27.335999"},{"x":"415.263855","y":"28.943998"},{"x":"419.361847","y":"30.551998"},{"x":"423.459839","y":"32.160000"},{"x":"427.557831","y":"33.768002"},{"x":"431.655823","y":"35.376003"},{"x":"435.753815","y":"36.984005"},{"x":"439.851807","y":"38.592007"},{"x":"443.949799","y":"40.200008"},{"x":"448.047791","y":"41.808010"},{"x":"452.145782","y":"43.416012"},{"x":"456.243774","y":"45.024014"},{"x":"460.341766","y":"46.632015"},{"x":"464.439758","y":"48.240017"},{"x":"468.537750","y":"49.848019"},{"x":"472.635742","y":"51.456020"},{"x":"476.733734","y":"53.064022"},{"x":"480.831726","y":"54.672024"},{"x":"484.929718","y":"56.280025"},{"x":"489.027710","y":"57.888027"},{"x":"493.125702","y":"59.496029"},{"x":"497.223694","y":"61.104031"},{"x":"501.321686","y":"62.712032"},{"x":"505.419678","y":"64.320030"},{"x":"509.517670","y":"65.928032"},{"x":"513.615662","y":"67.536034"},{"x":"517.713684","y":"69.144035"},{"x":"521.811707","y":"70.752037"},{"x":"525.909729","y":"72.360039"},{"x":"530.007751","y":"73.968040"},{"x":"534.105774","y":"75.576042"},{"x":"538.203796","y":"77.184044"},{"x":"542.301819","y":"78.792046"},{"x":"546.399841","y":"80.400047"},{"x":"550.497864","y":"82.008049"},{"x":"554.595886","y":"83.616051"},{"x":"558.693909","y":"85.224052"},{"x":"562.791931","y":"86.832054"},{"x":"566.889954","y":"88.440056"},{"x":"570.987976","y":"90.048058"},{"x":"575.085999","y":"91.656059"},{"x":"579.184021","y":"93.264061"},{"x":"583.282043","y":"94.872063"},{"x":"587.380066","y":"96.480064"},{"x":"591.478088","y":"98.088066"},{"x":"595.576111","y":"99.696068"},{"x":"599.674133","y":"101.304070"},{"x":"603.772156","y":"102.912071"},{"x":"607.870178","y":"104.520073"},{"x":"611.968201","y":"106.128075"},{"x":"616.066223","y":"107.736076"},{"x":"620.164246","y":"109.344078"},{"x":"624.262268","y":"110.952080"},{"x":"628.360291","y":"112.560081"},{"x":"632.458313","y":"114.168083"},{"x":"636.556335","y":"115.776085"},{"x":"640.654358","y":"117.384087"},{"x":"644.752380","y":"118.992088"},{"x":"648.850403","y":"120.600090"},{"x":"652.948425","y":"122.208092"},{"x":"657.046448","y":"123.816093"},{"x":"661.144470","y":"125.424095"},{"x":"665.242493","y":"127.032097"},{"x":"669.340515","y":"128.640091"},{"x":"673.438538","y":"130.248093"},{"x":"677.536560","y":"131.856094"},{"x":"681.634583","y":"133.464096"},{"pen_up":"true"},{"x":"170.750000","y":"67.000000"},{"x":"174.848007","y":"67.000000"},{"x":"178.946014","y":"67.000000"},{"x":"183.044022","y":"67.000000"},{"x":"187.142029","y":"67.000000"},{"x":"191.240036","y":"67.000000"},{"x":"195.338043","y":"67.000000"},{"x":"199.436050","y":"67.000000"},{"x":"203.534058","y":"67.000000"},{"x":"207.632065","y":"67.000000"},{"x":"211.730072","y":"67.000000"},{"x":"215.828079","y":"67.000000"},{"x":"219.926086","y":"67.000000"},{"x":"224.024094","y":"67.000000"},{"x":"228.122101","y":"67.000000"},{"x":"232.220108","y":"67.000000"},{"x":"236.318115","y":"67.000000"},{"x":"240.416122","y":"67.000000"},{"x":"244.514130","y":"67.000000"},{"x":"248.612137","y":"67.000000"},{"x":"252.710144","y":"67.000000"},{"x":"256.808136","y":"67.000000"},{"x":"260.906128","y":"67.000000"},{"x":"265.004120","y":"67.000000"},{"x":"269.102112","y":"67.000000"},{"x":"273.200104","y":"67.000000"},{"x":"277.298096","y":"67.000000"},{"x":"281.396088","y":"67.000000"},{"x":"285.494080","y":"67.000000"},{"x":"289.592072","y":"67.000000"},{"x":"293.690063","y":"67.000000"},{"x":"297.788055","y":"67.000000"},{"x":"301.886047","y":"67.000000"},{"x":"305.984039","y":"67.000000"},{"x":"310.082031","y":"67.000000"},{"x":"314.180023","y":"67.000000"},{"x":"318.278015","y":"67.000000"},{"x":"322.376007","y":"67.000000"},{"x":"326.473999","y":"67.000000"},{"x":"330.571991","y":"67.000000"},{"x":"334.669983","y":"67.000000"},{"x":"338.767975","y":"67.000000"},{"x":"342.865967","y":"67.000000"},{"x":"346.963959","y":"67.000000"},{"x":"351.061951","y":"67.000000"},{"x":"355.159943","y":"67.000000"},{"x":"359.257935","y":"67.000000"},{"x":"363.355927","y":"67.000000"},{"x":"367.453918","y":"67.000000"},{"x":"371.551910","y":"67.000000"},{"x":"375.649902","y":"67.000000"},{"x":"379.747894","y":"67.000000"},{"x":"383.845886","y":"67.000000"},{"x":"387.943878","y":"67.000000"},{"x":"392.041870","y":"67.000000"},{"x":"396.139862","y":"67.000000"},{"x":"400.237854","y":"67.000000"},{"x":"404.335846","y":"67.000000"},{"x":"408.433838","y":"67.000000"},{"x":"412.531830","y":"67.000000"},{"x":"416.629822","y":"67.000000"},{"x":"420.727814","y":"67.000000"},{"x":"424.825806","y":"67.000000"},{"x":"428.923798","y":"67.000000"},{"x":"433.021790","y":"67.000000"},{"x":"437.119781","y":"67.000000"},{"x":"441.217773","y":"67.000000"},{"x":"445.315765","y":"67.000000"},{"x":"449.413757","y":"67.000000"},{"x":"453.511749","y":"67.000000"},{"x":"457.609741","y":"67.000000"},{"x":"461.707733","y":"67.000000"},{"x":"465.805725","y":"67.000000"},{"x":"469.903717","y":"67.000000"},{"x":"474.001709","y":"67.000000"},{"x":"478.099701","y":"67.000000"},{"x":"482.197693","y":"67.000000"},{"x":"486.295685","y":"67.000000"},{"x":"490.393677","y":"67.000000"},{"x":"494.491669","y":"67.000000"},{"x":"498.589661","y":"67.000000"},{"x":"502.687653","y":"67.000000"},{"x":"506.785645","y":"67.000000"},{"x":"510.883636","y":"67.000000"},{"pen_up":"true"}]]});
        /*var req = _createXMLHttp();
        req.open('post','http://localhost:6600'/*'http://olthompson.com:6600'*//*,true);
        req.onreadystatechange = function(){
           if(req.status === 200 && req.readyState === 4){
               var obj = JSON.parse(req.responseText);
               if(!obj['error']){console.log(obj);
                    //_draw(obj);
                }
           }
        };
        req.send(JSON.stringify(snd_obj)); */
        _draw(obj);
    }
    return {
        init:init
    };
}